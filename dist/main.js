(()=>{"use strict";class t{content=document.querySelector("#content");mainContentContainer=document.querySelector(".main-content-container");todoscontainer=document.querySelector(".todos-container");constructor(){}loadTodos(t){let e=0;this.todoscontainer.innerHTML="";for(const n of t){const t=document.createElement("div");t.classList.add("todo-container"),t.setAttribute("data-todo-index",e),!0===n.complete&&t.classList.add("completed"),e++;const d=document.createElement("h2");d.classList.add("todo-title"),d.textContent=n.title;const c=document.createElement("p");c.classList.add("todo-description"),c.textContent=n.description;const s=document.createElement("p");s.classList.add("todo-date"),s.innerHTML=`<span class="due-date-label">Due Date: </span> ${n.dueDate.slice(5,7)}/${n.dueDate.slice(8,11)}/${n.dueDate.slice(0,4)}`;const a=document.createElement("p");a.classList.add("todo-time"),""!==n.time?a.innerHTML='<span class="due-time-label">Time Due: </span>'+(0==+(o=n.time).slice(0,2)?`${+o.slice(0,2)+12}:${o.slice(3,5)} AM`:+o.slice(0,2)<12?o+" AM":12==+o.slice(0,2)?`${o.slice(0,2)}:${o.slice(3,5)} PM`:`${+o.slice(0,2)-12}:${o.slice(3,5)} PM`):a.innerHTML='<span class="due-time-label">Time Due: </span> No Time Set';const i=document.createElement("button");i.setAttribute("type","button"),i.classList.add("complete-button"),!0===n.complete&&i.classList.add("completed"),!1===n.complete?i.textContent="Not Completed":i.textContent="Completed";const l=document.createElement("div");l.classList.add("todo-options"),l.innerHTML='<span class="material-symbols-outlined todo-options-icon">more_vert</span>';const r=document.createElement("div"),m=document.createElement("div");m.textContent="Remove",m.classList.add("remove-todo"),r.classList.add("todo-options-container","hidden"),r.append(m),l.append(r),t.append(d,c,s,a,i,l),this.todoscontainer.append(t)}var o}addCompletionButtonEvent(t){const e=document.querySelectorAll(".complete-button");for(const o of e)o.addEventListener("click",(e=>{o.classList.contains("completed")?(o.classList.remove("completed"),o.textContent="Not Completed",e.target.parentNode.classList.remove("completed"),t[e.target.parentNode.getAttribute("data-todo-index")].complete=!1):(o.classList.add("completed"),e.target.parentNode.classList.add("completed"),o.textContent="Completed",t[e.target.parentNode.getAttribute("data-todo-index")].complete=!0)}))}showTodoOptions(){const t=document.querySelectorAll(".todo-options-icon");for(const e of t)e.addEventListener("click",(t=>{const e=t.target.parentNode;console.log(e);const o=e.querySelector(".todo-options-container");o.classList.contains("hidden")?o.classList.remove("hidden"):o.classList.add("hidden")}))}}class e{constructor(t,e,o,n,d){this.title=t,this.description=e,this.dueDate=o,this.time=n,this.complete=d}}const o=new class{content=document.querySelector("#content");nav=document.querySelector(".navbar");constructor(){this.mainContent=new t}dimBackground(){this.nav.style.filter="brightness(50%)",this.mainContent.mainContentContainer.style.filter="brightness(50%)"}unDimBackground(){this.nav.removeAttribute("style"),this.mainContent.mainContentContainer.removeAttribute("style")}},n=new class{content=document.querySelector("#content");modalContainer=document.querySelector(".new-todo-container");constructor(){}toggleModalVisibility(){this.modalContainer.classList.toggle("hidden")}openModal(t){t.stopPropagation(),this.toggleModalVisibility()}closeModal(t){let e=t.target,o=!0;if(!t.target.classList.contains("submit-todo-button"))for(;e&&"BODY"!==e.nodeName;){if(e.classList.contains("new-todo-container")){o=!1;break}e=e.parentNode}return o&&!this.modalContainer.classList.contains("hidden")&&this.modalContainer.classList.toggle("hidden"),o}loadModalContent(){const t=document.querySelector("#tododate"),e=function(){const t=new Date,e=t.getFullYear(),o=t.getDate();let n=t.getMonth()+1;return n.toString.length<2&&(n="0"+n),{year:e,month:n,day:o}}();t.setAttribute({min:`${e.year}-${e.month}-${e.day}`,required:!0})}clearModalContent(){document.querySelector("#todoname").value="",document.querySelector("#tododescription").value="",document.querySelector("#tododate").value="",document.querySelector("#todotime").value=""}},d=[],c=document.querySelector(".new-todo-container"),s=document.querySelector(".add-todo-button"),a=document.querySelector(".submit-todo-button");function i(){const t=document.querySelectorAll(".remove-todo");for(const e of t)e.addEventListener("click",(t=>{const e=+t.target.parentNode.parentNode.parentNode.getAttribute("data-todo-index");d.splice(e,1),o.mainContent.loadTodos(d),r(),l(d),i()}))}function l(t){const e=document.querySelectorAll(".complete-button");for(const o of e)o.addEventListener("click",(e=>{o.classList.contains("completed")?(o.classList.remove("completed"),o.textContent="Not Completed",e.target.parentNode.classList.remove("completed"),t[e.target.parentNode.getAttribute("data-todo-index")].complete=!1):(o.classList.add("completed"),e.target.parentNode.classList.add("completed"),o.textContent="Completed",t[e.target.parentNode.getAttribute("data-todo-index")].complete=!0)}))}function r(){const t=document.querySelectorAll(".todo-options-icon");for(const e of t)e.addEventListener("click",(t=>{const e=t.target.parentNode.querySelector(".todo-options-container");e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden")}))}s.addEventListener("click",(t=>{c.classList.contains("hidden")&&(n.openModal(t),n.clearModalContent(),o.dimBackground())})),window.addEventListener("click",(t=>{n.closeModal(t)&&o.unDimBackground()})),a.addEventListener("click",(t=>{if(document.querySelector("form").checkValidity()){t.preventDefault();const c=document.querySelector("#todoname").value,s=document.querySelector("#tododescription").value,a=document.querySelector("#tododate").value,m=document.querySelector("#todotime").value,u=new e(c,s,a,m,!1);d.push(u),console.log(d),o.mainContent.loadTodos(d),n.closeModal(t),r(),l(d),i(),o.dimBackground()}else document.querySelector("form").reportValidity(),t.stopPropagation()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RHhDLGNBQWMsMkJBQ2xDOEMsRUFBUWxDLFVBQVV5QixTQUFTLFVBQWFTLEVBQVFsQyxVQUFVMEIsT0FBTyxVQUFZUSxFQUFRbEMsVUFBVUMsSUFBSSxTQUFTLEdBR3pILENBN0ZBc0UsRUFBY2hELGlCQUFpQixTQUFVQyxJQUNqQ3FCLEVBQWU3QyxVQUFVeUIsU0FBUyxZQUNsQ21CLEVBQVVJLFVBQVV4QixHQUNwQm9CLEVBQVV3QixvQkFDVmhDLEVBQWNHLGdCQUVsQixJQUtKcUMsT0FBT3JELGlCQUFpQixTQUFVQyxJQUNmb0IsRUFBVU0sV0FBVzFCLElBQ3hCWSxFQUFjTSxpQkFBaUIsSUFTL0M4QixFQUFpQmpELGlCQUFpQixTQUFVQyxJQUV4QyxHQURrQnJDLFNBQVNDLGNBQWMsUUFBUXlGLGdCQUs3QyxDQUNKckQsRUFBRXNELGlCQUNFLE1BQU0xRSxFQUFZakIsU0FBU0MsY0FBYyxhQUFhaUYsTUFDaEQ5RCxFQUFrQnBCLFNBQVNDLGNBQWMsb0JBQW9CaUYsTUFDN0Q1RCxFQUFXdEIsU0FBU0MsY0FBYyxhQUFhaUYsTUFDL0N6RCxFQUFXekIsU0FBU0MsY0FBYyxhQUFhaUYsTUFDL0N4RSxFQUFPLElBQUlzQyxFQUFLL0IsRUFBV0csRUFBaUJFLEVBQVVHLEdBQVUsR0FDdEUwRCxFQUFVUyxLQUFLbEYsR0FDZm1DLFFBQVFDLElBQUlxQyxHQUNabEMsRUFBY0UsWUFBWTlDLFVBQVU4RSxHQUNwQzFCLEVBQVVNLFdBQVcxQixHQUNyQk0sSUFDQVgsRUFBeUJtRCxHQUN6QnJELElBQ0FtQixFQUFjRyxlQUNsQixNQWxCSXBELFNBQVNDLGNBQWMsUUFBUTRGLGlCQUMvQnhELEVBQUV5QixpQkFpQk4sRyIsInNvdXJjZXMiOlsid2VicGFjazovL3RvZG8tbGlzdC1vZGlucHJvamVjdC8uL3NyYy9sb2FkaG9tZS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3Qtb2RpbnByb2plY3QvLi9zcmMvdGFza3MuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0LW9kaW5wcm9qZWN0Ly4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL3RvZG8tbGlzdC1vZGlucHJvamVjdC8uL3NyYy90b2RvbW9kYWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGFuZGluZ1BhZ2Uge1xuICAgIGNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29udGVudCcpO1xuICAgIG5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uYXZiYXInKTtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5tYWluQ29udGVudCA9IG5ldyBNYWluQ29udGVudDtcbiAgICB9XG5cbiAgICBkaW1CYWNrZ3JvdW5kKCkge1xuICAgICAgICB0aGlzLm5hdi5zdHlsZS5maWx0ZXIgPSAnYnJpZ2h0bmVzcyg1MCUpJztcbiAgICAgICAgdGhpcy5tYWluQ29udGVudC5tYWluQ29udGVudENvbnRhaW5lci5zdHlsZS5maWx0ZXIgPSAnYnJpZ2h0bmVzcyg1MCUpJztcbiAgICB9XG5cbiAgICB1bkRpbUJhY2tncm91bmQoKSB7XG4gICAgICAgIHRoaXMubmF2LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTtcbiAgICAgICAgdGhpcy5tYWluQ29udGVudC5tYWluQ29udGVudENvbnRhaW5lci5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgfVxuXG59XG5cblxuY2xhc3MgTWFpbkNvbnRlbnQge1xuICAgIGNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29udGVudCcpO1xuICAgIG1haW5Db250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1haW4tY29udGVudC1jb250YWluZXInKTtcbiAgICB0b2Rvc2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b2Rvcy1jb250YWluZXInKTtcbiAgICBjb25zdHJ1Y3RvcigpIHtcblxuICAgIH1cblxuXG4gICAgbG9hZFRvZG9zKGFycikge1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHRoaXMudG9kb3Njb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIGZvciAoY29uc3QgdG9kbyBvZiBhcnIpIHtcbiAgICAgICAgICAgIGNvbnN0IHRvZG9Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHRvZG9Db250YWluZXIuY2xhc3NMaXN0LmFkZCgndG9kby1jb250YWluZXInKTtcbiAgICAgICAgICAgIHRvZG9Db250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLXRvZG8taW5kZXgnLCBpKTtcbiAgICAgICAgICAgIGlmICh0b2RvLmNvbXBsZXRlID09PSB0cnVlKSB0b2RvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2NvbXBsZXRlZCcpO1xuICAgICAgICAgICAgaSsrXG4gICAgICAgICAgICAvL3RpdGxlXG4gICAgICAgICAgICBjb25zdCB0b2RvVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICAgICAgICAgICAgdG9kb1RpdGxlLmNsYXNzTGlzdC5hZGQoJ3RvZG8tdGl0bGUnKTtcbiAgICAgICAgICAgIHRvZG9UaXRsZS50ZXh0Q29udGVudCA9IHRvZG8udGl0bGU7XG5cbiAgICAgICAgICAgIC8vZGVzY3JpcHRpb25cbiAgICAgICAgICAgIGNvbnN0IHRvZG9EZXNjcmlwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgICAgICAgIHRvZG9EZXNjcmlwdGlvbi5jbGFzc0xpc3QuYWRkKCd0b2RvLWRlc2NyaXB0aW9uJyk7XG4gICAgICAgICAgICB0b2RvRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB0b2RvLmRlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICAvL2RhdGVcbiAgICAgICAgICAgIGNvbnN0IHRvZG9EYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgICAgICAgdG9kb0RhdGUuY2xhc3NMaXN0LmFkZCgndG9kby1kYXRlJyk7XG4gICAgICAgICAgICB0b2RvRGF0ZS5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJkdWUtZGF0ZS1sYWJlbFwiPkR1ZSBEYXRlOiA8L3NwYW4+ICR7dG9kby5kdWVEYXRlLnNsaWNlKDUsIDcpfS8ke3RvZG8uZHVlRGF0ZS5zbGljZSg4LCAxMSl9LyR7dG9kby5kdWVEYXRlLnNsaWNlKDAsIDQpfWA7XG5cbiAgICAgICAgICAgIC8vdGltZVxuICAgICAgICAgICAgY29uc3QgdG9kb1RpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgICAgICAgICB0b2RvVGltZS5jbGFzc0xpc3QuYWRkKCd0b2RvLXRpbWUnKTtcbiAgICAgICAgICAgIGlmICh0b2RvLnRpbWUgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgdG9kb1RpbWUuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwiZHVlLXRpbWUtbGFiZWxcIj5UaW1lIER1ZTogPC9zcGFuPiR7Zm9ybWF0VGltZSh0b2RvLnRpbWUpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0b2RvVGltZS5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJkdWUtdGltZS1sYWJlbFwiPlRpbWUgRHVlOiA8L3NwYW4+IE5vIFRpbWUgU2V0YDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9jb21wbGV0aW9uIGJ1dHRvblxuICAgICAgICAgICAgY29uc3QgY29tcGxldGVkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgICAgICBjb21wbGV0ZWQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2J1dHRvbicpXG4gICAgICAgICAgICBjb21wbGV0ZWQuY2xhc3NMaXN0LmFkZCgnY29tcGxldGUtYnV0dG9uJyk7XG4gICAgICAgICAgICBpZiAodG9kby5jb21wbGV0ZSA9PT0gdHJ1ZSkgY29tcGxldGVkLmNsYXNzTGlzdC5hZGQoJ2NvbXBsZXRlZCcpO1xuICAgICAgICAgICAgKHRvZG8uY29tcGxldGUgPT09IGZhbHNlKSA/IGNvbXBsZXRlZC50ZXh0Q29udGVudCA9ICdOb3QgQ29tcGxldGVkJyA6IGNvbXBsZXRlZC50ZXh0Q29udGVudCA9ICdDb21wbGV0ZWQnO1xuXG4gICAgICAgICAgICAvL29wdGlvbnMgbWVudVxuICAgICAgICAgICAgY29uc3Qgb3B0aW9uc01lbnVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIG9wdGlvbnNNZW51Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3RvZG8tb3B0aW9ucycpO1xuICAgICAgICAgICAgb3B0aW9uc01lbnVDb250YWluZXIuaW5uZXJIVE1MID0gJzxzcGFuIGNsYXNzPVwibWF0ZXJpYWwtc3ltYm9scy1vdXRsaW5lZCB0b2RvLW9wdGlvbnMtaWNvblwiPm1vcmVfdmVydDwvc3Bhbj4nO1xuXG4gICAgICAgICAgICAvL29wdGlvbnNcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZVRvZG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHJlbW92ZVRvZG8udGV4dENvbnRlbnQgPSAnUmVtb3ZlJztcbiAgICAgICAgICAgIHJlbW92ZVRvZG8uY2xhc3NMaXN0LmFkZCgncmVtb3ZlLXRvZG8nKTtcbiAgICAgICAgICAgIG9wdGlvbnNDb250YWluZXIuY2xhc3NMaXN0LmFkZCgndG9kby1vcHRpb25zLWNvbnRhaW5lcicsICdoaWRkZW4nKTtcbiAgICAgICAgICAgIG9wdGlvbnNDb250YWluZXIuYXBwZW5kKHJlbW92ZVRvZG8pO1xuXG5cblxuICAgICAgICAgICAgb3B0aW9uc01lbnVDb250YWluZXIuYXBwZW5kKG9wdGlvbnNDb250YWluZXIpO1xuICAgICAgICAgICAgdG9kb0NvbnRhaW5lci5hcHBlbmQodG9kb1RpdGxlLCB0b2RvRGVzY3JpcHRpb24sIHRvZG9EYXRlLCB0b2RvVGltZSwgY29tcGxldGVkLCBvcHRpb25zTWVudUNvbnRhaW5lcik7XG4gICAgICAgICAgICB0aGlzLnRvZG9zY29udGFpbmVyLmFwcGVuZCh0b2RvQ29udGFpbmVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZENvbXBsZXRpb25CdXR0b25FdmVudChhcnIpIHtcbiAgICAgICAgY29uc3QgY29tcGxldGlvbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb21wbGV0ZS1idXR0b24nKTtcbiAgICAgICAgZm9yIChjb25zdCBidXR0b24gb2YgY29tcGxldGlvbkJ1dHRvbikge1xuICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnY29tcGxldGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbXBsZXRlZCcpO1xuICAgICAgICAgICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAnTm90IENvbXBsZXRlZCdcbiAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjb21wbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgYXJyW2UudGFyZ2V0LnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRvZG8taW5kZXgnKV0uY29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ0NvbXBsZXRlZCc7XG4gICAgICAgICAgICAgICAgICAgIGFycltlLnRhcmdldC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS10b2RvLWluZGV4JyldLmNvbXBsZXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNob3dUb2RvT3B0aW9ucygpIHtcbiAgICAgICAgY29uc3QgdG9kb09wdGlvbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2RvLW9wdGlvbnMtaWNvbicpO1xuICAgICAgICBmb3IgKGNvbnN0IGJ1dHRvbiBvZiB0b2RvT3B0aW9uQnV0dG9uKSB7XG4gICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRvZG8gPSBlLnRhcmdldC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRvZG8pXG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRvZG8ucXVlcnlTZWxlY3RvcignLnRvZG8tb3B0aW9ucy1jb250YWluZXInKTtcbiAgICAgICAgICAgICAgICAob3B0aW9ucy5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSA/IG9wdGlvbnMuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJykgOiBvcHRpb25zLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZm9ybWF0VGltZSh0aW1lKSB7XG4gICAgaWYgKCt0aW1lLnNsaWNlKDAsIDIpID09PSAwKSByZXR1cm4gKGAkeyt0aW1lLnNsaWNlKDAsIDIpICsgMTJ9OiR7dGltZS5zbGljZSgzLCA1KX0gQU1gKTtcbiAgICBlbHNlIGlmICgrdGltZS5zbGljZSgwLCAyKSA8IDEyKSByZXR1cm4gKHRpbWUgKz0gJyBBTScpO1xuICAgIGVsc2UgaWYgKCt0aW1lLnNsaWNlKDAsIDIpID09PSAxMikgcmV0dXJuIChgJHt0aW1lLnNsaWNlKDAsIDIpfToke3RpbWUuc2xpY2UoMywgNSl9IFBNYCk7XG4gICAgZWxzZSByZXR1cm4gKGAkeyt0aW1lLnNsaWNlKDAsIDIpIC0gMTJ9OiR7dGltZS5zbGljZSgzLCA1KX0gUE1gKTtcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBUb0RvIHtcbiAgICBjb25zdHJ1Y3RvciAodGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCB0aW1lLCBjb21wbGV0ZSkge1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgdGhpcy5kdWVEYXRlID0gZHVlRGF0ZTtcbiAgICAgICAgdGhpcy50aW1lID0gdGltZTtcbiAgICAgICAgdGhpcy5jb21wbGV0ZSA9IGNvbXBsZXRlO1xuICAgIH1cbn0iLCJpbXBvcnQgeyBkZWZhdWx0IGFzIExhbmRpbmdQYWdlIH0gZnJvbSBcIi4vbG9hZGhvbWUuanNcIjtcbmltcG9ydCBUb0RvIGZyb20gXCIuL3Rhc2tzLmpzXCI7XG5pbXBvcnQgVG9Eb01vZGFsIGZyb20gXCIuL3RvZG9tb2RhbC5qc1wiO1xuXG5jb25zdCBsYW5kaW5nTG9hZGVyID0gbmV3IExhbmRpbmdQYWdlKCk7XG5jb25zdCB0b2RvbW9kYWwgPSBuZXcgVG9Eb01vZGFsKCk7XG5jb25zdCB0b2Rvc0xpc3QgPSBbXTtcbmNvbnN0IG1vZGFsQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ldy10b2RvLWNvbnRhaW5lcicpO1xuY29uc3QgbmV3VG9kb0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGQtdG9kby1idXR0b24nKTtcbmNvbnN0IHN1Ym1pdFRvZG9CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3VibWl0LXRvZG8tYnV0dG9uJyk7XG5cbi8vb3BlbnMgdGhlIGFkZCBuZXcgdG9kbyBtb2RhbFxubmV3VG9kb0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgaWYgKG1vZGFsQ29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHtcbiAgICAgICAgdG9kb21vZGFsLm9wZW5Nb2RhbChlKTtcbiAgICAgICAgdG9kb21vZGFsLmNsZWFyTW9kYWxDb250ZW50KCk7XG4gICAgICAgIGxhbmRpbmdMb2FkZXIuZGltQmFja2dyb3VuZCgpO1xuXG4gICAgfVxufSk7XG5cblxuLy9jbG9zZXMgYWRkIG5ldyB0b2RvIG1vZGFsXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIGNvbnN0IGNsb3NlZCA9IHRvZG9tb2RhbC5jbG9zZU1vZGFsKGUpO1xuICAgIGlmIChjbG9zZWQpIGxhbmRpbmdMb2FkZXIudW5EaW1CYWNrZ3JvdW5kKCk7XG5cbn0pXG5cblxuXG5cblxuXG5zdWJtaXRUb2RvQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBsZXQgaXNGb3JtVmFsaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtJykuY2hlY2tWYWxpZGl0eSgpO1xuICAgIGlmKCFpc0Zvcm1WYWxpZCkge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdmb3JtJykucmVwb3J0VmFsaWRpdHkoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gICAgZWxzZXsgXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCB0b2RvVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9kb25hbWUnKS52YWx1ZTtcbiAgICAgICAgY29uc3QgdG9kb0Rlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RvZG9kZXNjcmlwdGlvbicpLnZhbHVlO1xuICAgICAgICBjb25zdCB0b2RvRGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b2RvZGF0ZScpLnZhbHVlO1xuICAgICAgICBjb25zdCB0b2RvVGltZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b2RvdGltZScpLnZhbHVlO1xuICAgICAgICBjb25zdCB0b2RvID0gbmV3IFRvRG8odG9kb1RpdGxlLCB0b2RvRGVzY3JpcHRpb24sIHRvZG9EYXRlLCB0b2RvVGltZSwgZmFsc2UpO1xuICAgICAgICB0b2Rvc0xpc3QucHVzaCh0b2RvKTtcbiAgICAgICAgY29uc29sZS5sb2codG9kb3NMaXN0KVxuICAgICAgICBsYW5kaW5nTG9hZGVyLm1haW5Db250ZW50LmxvYWRUb2Rvcyh0b2Rvc0xpc3QpO1xuICAgICAgICB0b2RvbW9kYWwuY2xvc2VNb2RhbChlKTtcbiAgICAgICAgc2hvd1RvZG9PcHRpb25zKCk7XG4gICAgICAgIGFkZENvbXBsZXRpb25CdXR0b25FdmVudCh0b2Rvc0xpc3QpO1xuICAgICAgICByZW1vdmVUb2RvKCk7XG4gICAgICAgIGxhbmRpbmdMb2FkZXIuZGltQmFja2dyb3VuZCgpO1xuICAgIH1cbiAgICB9KVxuXG5cblxuZnVuY3Rpb24gcmVtb3ZlVG9kbyAoKSB7XG4gICAgY29uc3QgcmVtb3ZlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZW1vdmUtdG9kbycpO1xuICAgIGZvcihjb25zdCBidXR0b24gb2YgcmVtb3ZlQnV0dG9ucyl7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0b2RvQ29udGFpbmVyID0gZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gICAgICAgICAgICBjb25zdCB0b2RvaW5kZXggPSArdG9kb0NvbnRhaW5lci5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9kby1pbmRleCcpO1xuICAgICAgICAgICAgdG9kb3NMaXN0LnNwbGljZSh0b2RvaW5kZXgsIDEpO1xuICAgICAgICAgICAgbGFuZGluZ0xvYWRlci5tYWluQ29udGVudC5sb2FkVG9kb3ModG9kb3NMaXN0KTtcbiAgICAgICAgICAgIHNob3dUb2RvT3B0aW9ucygpO1xuICAgICAgICAgICAgYWRkQ29tcGxldGlvbkJ1dHRvbkV2ZW50KHRvZG9zTGlzdCk7XG4gICAgICAgICAgICByZW1vdmVUb2RvKCk7XG4gICAgICAgIH0pXG4gICAgfVxufVxuXG5cbmZ1bmN0aW9uIGFkZENvbXBsZXRpb25CdXR0b25FdmVudChhcnIpIHtcbiAgICBjb25zdCBjb21wbGV0aW9uQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbXBsZXRlLWJ1dHRvbicpO1xuICAgIGZvciAoY29uc3QgYnV0dG9uIG9mIGNvbXBsZXRpb25CdXR0b24pIHtcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZWQnKSkge1xuICAgICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdjb21wbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAnTm90IENvbXBsZXRlZCdcbiAgICAgICAgICAgICAgICBlLnRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NvbXBsZXRlZCcpO1xuICAgICAgICAgICAgICAgIGFycltlLnRhcmdldC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS10b2RvLWluZGV4JyldLmNvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LmFkZCgnY29tcGxldGVkJyk7XG4gICAgICAgICAgICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjb21wbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAnQ29tcGxldGVkJztcbiAgICAgICAgICAgICAgICBhcnJbZS50YXJnZXQucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9kby1pbmRleCcpXS5jb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgIH1cbn1cblxuZnVuY3Rpb24gc2hvd1RvZG9PcHRpb25zKCkge1xuICAgIGNvbnN0IHRvZG9PcHRpb25CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9kby1vcHRpb25zLWljb24nKTtcbiAgICBmb3IgKGNvbnN0IGJ1dHRvbiBvZiB0b2RvT3B0aW9uQnV0dG9uKSB7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0b2RvID0gZS50YXJnZXQucGFyZW50Tm9kZTtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0b2RvLnF1ZXJ5U2VsZWN0b3IoJy50b2RvLW9wdGlvbnMtY29udGFpbmVyJyk7XG4gICAgICAgICAgICAob3B0aW9ucy5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSA/IG9wdGlvbnMuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJykgOiBvcHRpb25zLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgICAgICB9KVxuICAgIH1cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBUb0RvTW9kYWwge1xuICAgIGNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29udGVudCcpO1xuICAgIG1vZGFsQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ldy10b2RvLWNvbnRhaW5lcicpO1xuICAgIGNvbnN0cnVjdG9yKCkge1xuXG4gICAgfVxuXG4gICAgdG9nZ2xlTW9kYWxWaXNpYmlsaXR5KCkge1xuICAgICAgICB0aGlzLm1vZGFsQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xuICAgIH1cblxuICAgIG9wZW5Nb2RhbChlKSB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMudG9nZ2xlTW9kYWxWaXNpYmlsaXR5KCk7XG4gICAgfVxuXG4gICAgY2xvc2VNb2RhbChlKSB7XG4gICAgICAgIGxldCByZXZpZXdOb2RlID0gZS50YXJnZXQ7XG4gICAgICAgIGxldCBleGl0Rm9ybSA9IHRydWU7XG4gICAgICAgIGlmICghZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzdWJtaXQtdG9kby1idXR0b24nKSkge1xuICAgICAgICAgICAgd2hpbGUgKHJldmlld05vZGUgJiYgcmV2aWV3Tm9kZS5ub2RlTmFtZSAhPT0gJ0JPRFknKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJldmlld05vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCduZXctdG9kby1jb250YWluZXInKSkge1xuICAgICAgICAgICAgICAgICAgICBleGl0Rm9ybSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV2aWV3Tm9kZSA9IHJldmlld05vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZXhpdEZvcm0gJiYgIXRoaXMubW9kYWxDb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkge1xuICAgICAgICAgICAgdGhpcy5tb2RhbENvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBleGl0Rm9ybTtcbiAgICB9XG5cbiAgICBsb2FkTW9kYWxDb250ZW50KCkge1xuICAgICAgICAvL2RhdGVcbiAgICAgICAgY29uc3QgdGFza0RhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9kb2RhdGUnKTtcbiAgICAgICAgY29uc3QgY3VycmVudERhdGUgPSBnZXRDdXJyZW50RGF0ZSgpO1xuICAgICAgICB0YXNrRGF0ZS5zZXRBdHRyaWJ1dGUoeydtaW4nOiBgJHtjdXJyZW50RGF0ZS55ZWFyfS0ke2N1cnJlbnREYXRlLm1vbnRofS0ke2N1cnJlbnREYXRlLmRheX1gLCAncmVxdWlyZWQnOiB0cnVlfSlcblxuICAgIH1cblxuICAgIGNsZWFyTW9kYWxDb250ZW50KCkge1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9kb25hbWUnKS52YWx1ZSA9ICcnO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9kb2Rlc2NyaXB0aW9uJykudmFsdWUgPSAnJztcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RvZG9kYXRlJykudmFsdWUgPSAnJztcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RvZG90aW1lJykudmFsdWUgPSAnJztcblxuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0Q3VycmVudERhdGUoKSB7XG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICBjb25zdCBkYXkgPSBkYXRlLmdldERhdGUoKTtcbiAgICBsZXQgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxO1xuICAgIGlmIChtb250aC50b1N0cmluZy5sZW5ndGggPCAyKSBtb250aCA9ICcwJyArIG1vbnRoO1xuICAgIHJldHVybiB7IHllYXIsIG1vbnRoLCBkYXkgfVxufSJdLCJuYW1lcyI6WyJNYWluQ29udGVudCIsImNvbnRlbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJtYWluQ29udGVudENvbnRhaW5lciIsInRvZG9zY29udGFpbmVyIiwiY29uc3RydWN0b3IiLCJsb2FkVG9kb3MiLCJhcnIiLCJpIiwidGhpcyIsImlubmVySFRNTCIsInRvZG8iLCJ0b2RvQ29udGFpbmVyIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImNvbXBsZXRlIiwidG9kb1RpdGxlIiwidGV4dENvbnRlbnQiLCJ0aXRsZSIsInRvZG9EZXNjcmlwdGlvbiIsImRlc2NyaXB0aW9uIiwidG9kb0RhdGUiLCJkdWVEYXRlIiwic2xpY2UiLCJ0b2RvVGltZSIsInRpbWUiLCJjb21wbGV0ZWQiLCJvcHRpb25zTWVudUNvbnRhaW5lciIsIm9wdGlvbnNDb250YWluZXIiLCJyZW1vdmVUb2RvIiwiYXBwZW5kIiwiYWRkQ29tcGxldGlvbkJ1dHRvbkV2ZW50IiwiY29tcGxldGlvbkJ1dHRvbiIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImNvbnRhaW5zIiwicmVtb3ZlIiwidGFyZ2V0IiwicGFyZW50Tm9kZSIsImdldEF0dHJpYnV0ZSIsInNob3dUb2RvT3B0aW9ucyIsInRvZG9PcHRpb25CdXR0b24iLCJjb25zb2xlIiwibG9nIiwib3B0aW9ucyIsIlRvRG8iLCJsYW5kaW5nTG9hZGVyIiwibmF2IiwibWFpbkNvbnRlbnQiLCJkaW1CYWNrZ3JvdW5kIiwic3R5bGUiLCJmaWx0ZXIiLCJ1bkRpbUJhY2tncm91bmQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJ0b2RvbW9kYWwiLCJtb2RhbENvbnRhaW5lciIsInRvZ2dsZU1vZGFsVmlzaWJpbGl0eSIsInRvZ2dsZSIsIm9wZW5Nb2RhbCIsInN0b3BQcm9wYWdhdGlvbiIsImNsb3NlTW9kYWwiLCJyZXZpZXdOb2RlIiwiZXhpdEZvcm0iLCJub2RlTmFtZSIsImxvYWRNb2RhbENvbnRlbnQiLCJ0YXNrRGF0ZSIsImN1cnJlbnREYXRlIiwiZGF0ZSIsIkRhdGUiLCJ5ZWFyIiwiZ2V0RnVsbFllYXIiLCJkYXkiLCJnZXREYXRlIiwibW9udGgiLCJnZXRNb250aCIsInRvU3RyaW5nIiwibGVuZ3RoIiwiZ2V0Q3VycmVudERhdGUiLCJjbGVhck1vZGFsQ29udGVudCIsInZhbHVlIiwidG9kb3NMaXN0IiwibmV3VG9kb0J1dHRvbiIsInN1Ym1pdFRvZG9CdXR0b24iLCJyZW1vdmVCdXR0b25zIiwidG9kb2luZGV4Iiwic3BsaWNlIiwid2luZG93IiwiY2hlY2tWYWxpZGl0eSIsInByZXZlbnREZWZhdWx0IiwicHVzaCIsInJlcG9ydFZhbGlkaXR5Il0sInNvdXJjZVJvb3QiOiIifQ==